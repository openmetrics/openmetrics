<% content_for :page_header do %>
    <h3>
      <%= badge_label @system, {:label_class => 'primary'} %>
      <span class="btn-group btn-group-sm pull-right">
        <%= link_to t('om.controls.delete_html'), @system, :confirm => 'Are you sure?', :method => :delete, :class => 'btn btn-default' %>
        <%= link_to t('om.controls.edit_html'), edit_system_path(@system), :class => 'btn btn-default' %>
      </span>
    </h3>
<% end %>

<div class="row">

  <!-- left column -->
  <div class="col-md-8">

    <!-- metrics tabs left -->
    <% if @system_metrics.any? %>
        <h3>Metrics</h3>
        <div class="panel panel-default">
          <div class="panel-body">
            <div class="tabbable">
              <ul class="nav nav-tabs">
                <% @system_metrics.each_with_index do |plugin, index| %>
                    <li <%= 'class=active' if index == 0 %> >
                      <a href="#<%= plugin.first %>" data-toggle="tab"><%= plugin.first %></a>
                    </li>
                <% end %>
              </ul>
              <div class="tab-content">
                <% @system_metrics.each_with_index do |plugin, index| %>
                    <div class="tab-pane <%= 'active' if index == 0 %>" id="<%= plugin.first %>">
                      <% rrds = @system_metrics[plugin.first].group_by(&:rrd_file) %>
                      <% rrds.each_pair do |rrd, x| %>
                          <h4><%= rrd %></h4>
                          <% img_path = "/collectd/#{@system.fqdn}.dir/#{@system.fqdn}/#{x.first.plugin}/#{x.first.rrd_file}-1day.png" %>
                          <img src="<%= img_path %>"/>
                      <% end %>

                    </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
    <% end %>
    <!-- /tabs -->

    <div class="clearfix"></div>


    <!-- timeline (will be filled by js) -->
    <h3 class="spacer">Events</h3>
    <div class="panel panel-default">
      <div class="panel-body">
        <%= render 'shared/activities', events: @system_events %>
        <h4>Timeline</h4>
        <div id="system-timeline" data-events="<%= @system_events.to_json %>"></div>
      </div>
    </div>

    <!-- system graph (will be filled by js) -->
    <h3 class="spacer">Relation Graph</h3>

    <div class="clearfix"></div>
    <div class="panel panel-default ">
      <div class="panel-body">
        <div id="system-graph" data-system="<%= @system.to_json %>"
             data-services="<%= @services.all.to_json(only: [:id, :name]) %>"
             data-running_services="<%= @system.running_services.all.to_json(except: [:type, :created_at, :updated_at]) %>"></div>
      </div>
    </div>

  </div>


  <!-- right column -->
  <div class="col-md-4">
    <%= render :partial => 'system_information' %>
    <h3 class="spacer">Running Services</h3>
    <div class="list-group running_service">
      <%= render :partial => 'running_services', :collection => @system.running_services, :as => :rs %>
    </div>

  </div>
</div>